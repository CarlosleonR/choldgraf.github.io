<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"> <!-- begin SEO --><title>Adding copy buttons to code blocks in Sphinx - Predictably Noisy</title><meta property="og:locale" content="en-US"><meta property="og:site_name" content="Predictably Noisy"><meta property="og:title" content="Adding copy buttons to code blocks in Sphinx"><link rel="canonical" href="https://predictablynoisy.com/sphinx-copy-buttons"><meta property="og:url" content="https://predictablynoisy.com/sphinx-copy-buttons"><meta name="twitter:site" content="@choldgraf"><meta name="twitter:title" content="Adding copy buttons to code blocks in Sphinx"><meta name="twitter:description" content="About Me"><meta name="twitter:url" content="https://predictablynoisy.com/sphinx-copy-buttons"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://predictablynoisy.com/images/profile.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2018-07-05T00:00:00+00:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Organization", "url": "https://predictablynoisy.com", "logo": "https://predictablynoisy.com/images/profile.png" } </script> <script type="application/ld+json"> { "@context" : "https://schema.org", "@type" : "Person", "name" : "Chris Holdgraf", "url" : "https://predictablynoisy.com", "sameAs" : null } </script> <!-- end SEO --><link href="https://predictablynoisy.com/feed.xml" type="application/atom+xml" rel="alternate" title="Predictably Noisy Feed"> <!-- http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script> document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js '; </script> <!-- For all browsers --><link rel="stylesheet" href="https://predictablynoisy.com/assets/css/main.css"> <!-- Jupyter Book CSS and JS --><link rel="stylesheet" href="https://predictablynoisy.com/assets/css/main.css"> <!-- Custom CSS --><link rel="stylesheet" href="https://predictablynoisy.com/assets/css/jupyterbook.css"> <script type="text/javascript" src="https://predictablynoisy.com/assets/js/jupyterbook.js"></script><meta http-equiv="cleartype" content="on"> <!-- start custom head snippets --><link rel="apple-touch-icon" sizes="57x57" href="https://predictablynoisy.com/images/apple-touch-icon-57x57.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="60x60" href="https://predictablynoisy.com/images/apple-touch-icon-60x60.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="72x72" href="https://predictablynoisy.com/images/apple-touch-icon-72x72.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="76x76" href="https://predictablynoisy.com/images/apple-touch-icon-76x76.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="114x114" href="https://predictablynoisy.com/images/apple-touch-icon-114x114.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="120x120" href="https://predictablynoisy.com/images/apple-touch-icon-120x120.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="144x144" href="https://predictablynoisy.com/images/apple-touch-icon-144x144.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="152x152" href="https://predictablynoisy.com/images/apple-touch-icon-152x152.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="180x180" href="https://predictablynoisy.com/images/apple-touch-icon-180x180.png?v=M44lzPylqQ"><link rel="icon" type="image/png" href="https://predictablynoisy.com/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32"><link rel="icon" type="image/png" href="https://predictablynoisy.com/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192"><link rel="icon" type="image/png" href="https://predictablynoisy.com/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96"><link rel="icon" type="image/png" href="https://predictablynoisy.com/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16"><link rel="manifest" href="https://predictablynoisy.com/images/manifest.json?v=M44lzPylqQ"><link rel="mask-icon" href="https://predictablynoisy.com/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000"><link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ"><meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://predictablynoisy.com/images/mstile-144x144.png?v=M44lzPylqQ"><meta name="msapplication-config" content="https://predictablynoisy.com/images/browserconfig.xml?v=M44lzPylqQ"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="https://predictablynoisy.com/assets/css/academicons.css"/> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <!-- Load JQuery --> <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script> <!-- Load clipboard.js --> <script src="https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"></script> <!-- Custom scripts to load after site JS is loaded --> <script src="https://predictablynoisy.com/assets/js/copypaste.js" type="text/javascript"></script> <!-- end custom head snippets --><link rel="stylesheet" href="/assets/css/data8.css"><link rel="stylesheet" href="/assets/css/holdgraf.css"></head><body> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"> <button><div class="navicon"></div></button><ul class="visible-links"><li class="masthead__menu-item masthead__menu-item--lg"><a href="https://predictablynoisy.com/">Predictably Noisy</a></li><li class="masthead__menu-item"><a href="/about/">About me</a></li><li class="masthead__menu-item"><a href="/publications/">Publications</a></li></ul><ul class="hidden-links hidden"></ul></nav></div></div></div><div id="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="http://schema.org/Person"><div class="author__avatar"> <img src="https://predictablynoisy.com/images/profile.png" class="author__avatar" alt="Chris Holdgraf"></div><div class="author__content"><h3 class="author__name">Chris Holdgraf</h3><p class="author__bio">Data Science | Open Science | Brains</p></div><div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button><ul class="author__urls social-icons"><li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Berkeley, CA</li><li><a href="mailto:hldgrf@gmail.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li><li><a href="https://twitter.com/choldgraf"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li><li><a href="https://www.linkedin.com/in/chrisholdgraf"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li><li><a href="https://github.com/choldgraf"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li><li><a href="https://scholar.google.com/citations?user=fJmcIEIAAAAJ&hl=en"><i class="ai ai-google-scholar-square ai-fw"></i> Google Scholar</a></li><li><a href="https://orcid.org/0000-0002-2391-0678"><i class="ai ai-orcid-square ai-fw"></i> ORCID</a></li></ul></div></div></div><article class="page" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="headline" content="Adding copy buttons to code blocks in Sphinx"><meta itemprop="datePublished" content="July 05, 2018"><div class="page__inner-wrap"><header><h1 class="page__title" itemprop="headline">Adding copy buttons to code blocks in Sphinx</h1><p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Published:</strong> <time datetime="2018-07-05T00:00:00+00:00">July 05, 2018</time></p></header><section class="page__content" itemprop="text"><blockquote><p><strong>NOTE: This is now a sphinx extension!</strong> Thanks to some friendly suggestions, I’ve written this up as a super tiny sphinx extension. Check it out here: https://github.com/choldgraf/sphinx-copybutton</p></blockquote><p><a href="http://www.sphinx-doc.org/en/master/">Sphinx</a> is a fantastic way to build documentation for your Python package. On the Jupyter project, we use it for almost all of our repositories.</p><p>A common use for Sphinx is to step people through a chunk of code. For example, in the <a href="https://zero-to-jupyterhub.readthedocs.io/en/latest/">Zero to JupyterHub for Kubernetes</a> guide we step users through a number of installation and configuration steps.</p><p>A common annoyance is that there is a lot of copy/pasting involved. Sometimes you accidentally miss a character or some whitespace. So, I spent a bit of time figuring out how to <strong>automatically embed a copy button into code blocks</strong>. It turns out this is pretty easy!</p><p>Here’s what the final result will look like (just hover the code block below)</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wow</span> <span class="o">=</span> <span class="n">this_text</span>
<span class="n">is_so</span> <span class="o">=</span> <span class="n">much</span><span class="o">*</span><span class="n">more</span><span class="o">*</span><span class="n">copyable</span>
</code></pre></div></div><h2 id="adding-a-copy-button-to-your-sphinx-code-blocks">Adding a copy button to your Sphinx code blocks</h2><p>To accomplish this we’ll use the excellent <a href="https://clipboardjs.com/">clipboard.js</a> which provides the machinery for copying the contents of an HTML element as well as <a href="https://jquery.com/">jquery</a> for modifying our built documentation on-demand.</p><p>The result will be a Sphinx site with code blocks that display a copy button when you hover over them. You can see how it looks on this very page, which uses a similar method (but is built with Jekyll).</p><p>Here’s what you should do:</p><ol><li><p><strong>Add the clipboard.js javascript</strong>. Create a javascript script called <code class="language-plaintext highlighter-rouge">doc/_static/custom.js</code>. In the file, put the following code (see comments for explanation):</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">function</span> <span class="nx">addCopyButtonToCode</span><span class="p">(){</span>
 <span class="c1">// get all code elements</span>
 <span class="kd">var</span> <span class="nx">allCodeBlocksElements</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="dl">"</span><span class="s2">div.highlight pre</span><span class="dl">"</span> <span class="p">);</span>

 <span class="c1">// For each element, do the following steps</span>
 <span class="nx">allCodeBlocksElements</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ii</span><span class="p">)</span> <span class="p">{</span>
 <span class="c1">// define a unique id for this element and add it</span>
 <span class="kd">var</span> <span class="nx">currentId</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">codeblock</span><span class="dl">"</span> <span class="o">+</span> <span class="p">(</span><span class="nx">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
 <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="dl">'</span><span class="s1">id</span><span class="dl">'</span><span class="p">,</span> <span class="nx">currentId</span><span class="p">);</span>

 <span class="c1">// create a button that's configured for clipboard.js</span>
 <span class="c1">// point it to the text that's in this code block</span>
 <span class="c1">// add the button just after the text in the code block w/ jquery</span>
 <span class="kd">var</span> <span class="nx">clipButton</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;button class="btn copybtn" data-clipboard-target="#</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">currentId</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"&gt;&lt;img src="https://clipboardjs.com/assets/images/clippy.svg" width="13" alt="Copy to clipboard"&gt;&lt;/button&gt;</span><span class="dl">'</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">after</span><span class="p">(</span><span class="nx">clipButton</span><span class="p">);</span>
 <span class="p">});</span>

 <span class="c1">// tell clipboard.js to look for clicks that match this query</span>
 <span class="k">new</span> <span class="nx">Clipboard</span><span class="p">(</span><span class="dl">'</span><span class="s1">.btn</span><span class="dl">'</span><span class="p">);</span>
 <span class="p">}</span>

 <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
 <span class="c1">// Once the DOM is loaded for the page, attach clipboard buttons</span>
 <span class="nx">addCopyButtonToCode</span><span class="p">();</span>
 <span class="p">});</span>
</code></pre></div></div></li><li><p><strong>Add some CSS to make it pretty</strong>. Create a custom CSS file called <code class="language-plaintext highlighter-rouge">doc/_static/custom.css</code> (or add to one you’ve already got). In the file, put these lines:</p><div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">/* Copy buttons */</span>
<span class="nt">button</span><span class="nc">.copybtn</span> <span class="p">{</span>
  <span class="py">webkit-transition</span><span class="p">:</span> <span class="n">opacity</span> <span class="m">.3s</span> <span class="n">ease-in-out</span><span class="p">;</span>
  <span class="nl">-o-transition</span><span class="p">:</span> <span class="n">opacity</span> <span class="m">.3s</span> <span class="n">ease-in-out</span><span class="p">;</span>
  <span class="nl">transition</span><span class="p">:</span> <span class="n">opacity</span> <span class="m">.3s</span> <span class="n">ease-in-out</span><span class="p">;</span>
  <span class="nl">opacity</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
  <span class="nl">padding</span><span class="p">:</span> <span class="m">2px</span> <span class="m">6px</span><span class="p">;</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
  <span class="nl">right</span><span class="p">:</span> <span class="m">4px</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">4px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">div</span><span class="nc">.highlight</span><span class="nd">:hover</span> <span class="nc">.copybtn</span><span class="o">,</span> <span class="nt">div</span><span class="nc">.highlight</span> <span class="nc">.copybtn</span><span class="nd">:focus</span> <span class="p">{</span>
    <span class="nl">opacity</span><span class="p">:</span> <span class="m">.3</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">div</span><span class="nc">.highlight</span> <span class="nc">.copybtn</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="nl">opacity</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">div</span><span class="nc">.highlight</span> <span class="p">{</span>
    <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div></li><li><p><strong>Link these scripts in your configuration.</strong> You need to link your custom JS and CSS scripts, as well as the clipboard.js script so it ships with your site. In your <code class="language-plaintext highlighter-rouge">conf.py</code> file, add the following function/lines (or add to one you’ve already got defined).</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="p">.</span><span class="n">add_stylesheet</span><span class="p">(</span><span class="s">'custom.css'</span><span class="p">)</span>
    <span class="n">app</span><span class="p">.</span><span class="n">add_javascript</span><span class="p">(</span><span class="s">"custom.js"</span><span class="p">)</span>
    <span class="n">app</span><span class="p">.</span><span class="n">add_javascript</span><span class="p">(</span><span class="s">"https://cdn.jsdelivr.net/npm/clipboard@1/dist/clipboard.min.js"</span><span class="p">)</span>
</code></pre></div></div></li></ol><p>And that’s it! Once you clear your Sphinx cache and re-build your site, you should now have buttons that appear when you hover over them, and that copy the text inside when you click them.</p><h2 id="thanks">Thanks</h2><p>Many thanks to <a href="https://stackoverflow.com/a/48078807/1927102">this StackOverflow post</a> for the majority of the code that led to this hack!</p></section><footer class="page__meta"></footer></div></article></div></script><div class="page__footer"><footer> <!-- start custom footer snippets --> <a href="/sitemap/">Sitemap</a> <!-- end custom footer snippets --><div class="page__footer-follow"><ul class="social-icons"><li><strong>Follow:</strong></li><li><a href="https://twitter.com/choldgraf"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li><li><a href="http://github.com/choldgraf"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li><li><a href="https://predictablynoisy.com/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li></ul></div><div class="page__footer-copyright">&copy; 2020 Chris Holdgraf. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div></footer></div><script src="https://predictablynoisy.com/assets/js/main.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-88310237-1', 'auto'); ga('send', 'pageview'); </script></body></html>
